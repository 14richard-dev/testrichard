name: Deployment

on:
  push:
    branches:
      - master

jobs:
  job1:
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout"
        uses: actions/checkout@v4

      - name: "Build the image"
        run: |
          docker build -t 14richard-dev/testimage100 .

      - name: "Push to DockerHub"
        run: |
          docker login -u 14richard-dev -p ${{ secrets.DOCKER_PASSWORD }}
          docker push 14richard-dev/testimage100
          echo "Image pushed successfully!"

  job2:
    runs-on: ubuntu-latest
    needs: job1
    steps:
      - name: "Confirm the job"
        run: echo "This is the second job"

      - name: "Checkout"
        uses: actions/checkout@v4

      - name: "Upload as first artifact"
        uses: actions/upload-artifact@v4
        with:
          name: "sample-artifact"
          path: "index.html"
          retention-days: 60

      - name: "Upload as second artifact"
        uses: actions/upload-artifact@v4
        with:
          name: "sample-artifact2"
          path: "index.html"
          retention-days: 60

      - name: "Pull the image from DockerHub into environment"
        run: |
          docker pull 14richard-dev/testimage100
          echo "Image pulled successfully!"
          docker run -d -p 8080:80 14richard-dev/testimage100
